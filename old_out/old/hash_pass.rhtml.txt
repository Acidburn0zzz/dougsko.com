<% require 'rubygems' %>		
<% require 'pfunk' %>
<% require 'hashpass' %>
<% require 'cgi' %>

<% funk = Pfunk.new %>

<% puts funk.print_head %>
<body>

<div id="heading">
	<a href="index.rhtml">dougsko dot com</a>
</div>

<div id="navigation">
<%
funk.list_files do |full, nice|
        puts "<a href=#{full}>#{nice}</a><br />"
end
%>
</div>

<% text =<<EOF
h2. make unique sha1 passwords

This generator can be used to create secure passwords for web accounts.

It is effectively equivalent to running:
  <pre> echo -n "MasterPassDomain.com" | sha1 </pre>

Your master password stays the same each time, but since the domain will vary,
you will get a unique SHA1 hash for each web account you have.  These hashes
make very secure passwords, and require you to memorize only one main password.
The downside is that you need to generate them each time you want to log in to
an account.  

EOF
%>

<div id="centerDoc">
<% puts funk.reddify("#{text}") %>

<%      cgi = CGI.new()
	@match = 0
        if cgi.params['master_pass1'].to_s.chomp.length > 0
                if cgi.params['master_pass1'] == cgi.params['master_pass2']
                        @hash = HashPass.new(cgi.params['master_pass1'], cgi.params['domain']).print
			@match = 1
		end     
	else    
		@hash = ""
		@match = 1
	end
%>

<br>
<form method="POST" action="hash_pass.rhtml">
	Master Pass: 
	<input type="password" name="master_pass1">
	<br>
	Retype Master Pass:
	<input type="password" name="master_pass2">
	<br>
	Domain Name: 
	<input type="text" name="domain">
	<br>
	Hash:
        <input type="text" value=<%=@hash%> >
	<br>
	<input type="submit" value="Submit">
</form>
<% 	if @match == 0
		puts "<h3><font color=red>Passwords do not match!!<font></h3>"
	end
%>

</div>

<div id="footer">
        <% me = `basename #{__FILE__}` %>
        <% puts "<a href='#{me}.txt'>view source</a>" %>
</div>

</body>
</html>
